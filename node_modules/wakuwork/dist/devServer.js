import http from"node:http";import{pipe}from"./middleware/common.js";export function startDevServer(config={}){const shared={};const middlewares=config.devServer?.middlewares||["rewriteRsc","rscDev","viteServer","notFound"];const resolvedMiddlewares=Promise.all(middlewares.map(async middleware=>{if(typeof middleware==="string"){const mod=await import(`./middleware/${middleware}.js`);return(mod.default||mod)(config,shared)}return middleware}));const server=http.createServer(async(req,res)=>{try{await pipe(await resolvedMiddlewares)(req,res,async()=>{});return}catch(e){console.info(e)}res.statusCode=500;res.end()});const port=config.devServer?.port??3e3;server.listen(port,()=>{console.info("Listening on",port)})}