"use strict";Object.defineProperty(exports,"__esModule",{value:true});Object.defineProperty(exports,"default",{enumerable:true,get:()=>_default});const _nodePath=_interopRequireDefault(require("node:path"));const _nodeFs=_interopRequireDefault(require("node:fs"));const _promises=_interopRequireDefault(require("node:fs/promises"));function _interopRequireDefault(obj){return obj&&obj.__esModule?obj:{default:obj}}const staticFile=(config,shared)=>{const dir=_nodePath.default.resolve(config.prdServer?.dir||".");const publicPath=config.files?.public||"public";const indexHtml=config.files?.indexHtml||"index.html";const indexHtmlFile=_nodePath.default.join(dir,publicPath,indexHtml);return async(req,res,next)=>{const url=new URL(req.url||"","http://"+req.headers.host);const hasExtension=url.pathname.split(".").length>1;if(!hasExtension){const stat=_nodeFs.default.statSync(indexHtmlFile,{throwIfNoEntry:false});if(stat){res.setHeader("Content-Type","text/html; charset=utf-8");const code=await shared.prdScriptToInject?.(req.url||"");if(code){let data=await _promises.default.readFile(indexHtmlFile,{encoding:"utf-8"});data=data.replace(/<\/body>/,`<script>${code}</script></body>`);res.end(data);return}res.setHeader("Content-Length",stat.size);_nodeFs.default.createReadStream(indexHtmlFile).pipe(res);return}}await next()}};const _default=staticFile;